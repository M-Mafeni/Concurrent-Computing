//interfacearrays.xc
#include <platform.h>
#include <stdio.h>
#include <string.h>

//define a communication interface i
typedef interface i {
  int f(int a[]);
  void g();
} i;

//server task providing functionality of i
void myServer(server i myInterface[n], unsigned n) {
  int serving = 1;
  int data[2] = {10,11};
  while (serving)
    select {
      case myInterface[int j].f(int a[]) -> int returnval:
        printf("f called from %d \n",j);
        //memcpy(a, data , 2*sizeof(int));
        a[0] = data[0];
        a[1] = data[1];
        returnval = a[0];
        break;
      case myInterface[int j].g():
        printf("g was called from %d\n",j);
        serving = 0;
        break;
} }

//client task calling functions
void myClient(client i myInterface, int j) {
  int a[2] = {0,0};
  printf("f returns: %d \n", myInterface.f(a));
  printf("a set to: [%d,%d] \n", a[0], a[1]);
  if (j==1) myInterface.g();
}

//main starting two threads
int main() {
  interface i myInterface[2];
  par {
    on tile[0]: myServer(myInterface,2);
    on tile[1]: {
                  myClient(myInterface[0],0);
                  myClient(myInterface[1],1);
                }
  }
  return 0;
}
