//valuereturn.xc
#include <platform.h>
#include <stdio.h>

//define a communication interface i
typedef interface i {
  int f(int x);
  void g();
} i;

//server task providing functionality of i
void myServer(server i myInterface) {
  int serving = 1;
  while (serving)
    select {
      case myInterface.f(int x) -> int returnval:
        printf("f receives: %d \n", x);
        returnval = x * 2;
        break;
      case myInterface.g():
        printf("g was called\n");
        serving = 0;
        break;
} }

//client task calling functions
void myClient(client i myInterface) {
  printf("f returns: %d \n", myInterface.f(1));
  myInterface.g();
}

//main starting two threads
int main() {
  interface i myInterface;
  par {
    on tile[0]: myServer(myInterface);
    on tile[1]: myClient(myInterface);
  }
  return 0;
}
